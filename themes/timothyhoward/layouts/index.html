{{ define "main" }}
<section class="section section-tight">
  <div class="container home-intro">
    <div class="intro-panel">
      <div class="intro-body">
        {{ .Content }}
      </div>
      <a class="text-link read-more" href="{{ .Site.Params.cta.resume }}">
        Resume
        <svg class="icon link-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M7 17l10-10"/>
          <path d="M10 7h7v7"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<section class="section">
  <div class="container section-header simple-header">
    <h2>Writing</h2>
    <div class="section-actions">
      <a class="section-link" href="{{ "writing/" | relURL }}">
        All writing
        <svg class="icon link-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M7 17l10-10"/>
          <path d="M10 7h7v7"/>
        </svg>
      </a>
      {{ $writing := .Site.GetPage "section" "writing" }}
      {{ with $writing }}
        {{ with .OutputFormats.Get "WritingRSS" }}
          <a class="rss-link" href="{{ .RelPermalink }}" aria-label="RSS feed">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 4a16 16 0 0 1 16 16"/>
              <path d="M4 11a9 9 0 0 1 9 9"/>
              <circle cx="5" cy="19" r="1.5"/>
            </svg>
          </a>
        {{ end }}
      {{ end }}
    </div>
  </div>
  <div class="container list-stack">
    {{ $items := where .Site.RegularPages "Type" "in" (slice "notes" "posts") }}
    {{ $latest := first 5 $items.ByDate.Reverse }}
    {{ if gt (len $latest) 0 }}
      {{ range $latest }}
        {{ partial "writing-row.html" . }}
      {{ end }}
    {{ else }}
      <p class="muted">No posts or notes yet.</p>
    {{ end }}
  </div>
</section>

<section class="section">
  <div class="container section-header simple-header">
    <h2>Photography</h2>
    <div class="section-actions">
      {{ with .Site.Params.flickr.profile }}
        <a class="rss-link" href="{{ . }}" rel="noopener" aria-label="Flickr">
          <svg class="icon icon-fill" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="8" cy="12" r="3.5"/>
            <circle cx="16" cy="12" r="3.5"/>
          </svg>
        </a>
      {{ end }}
    </div>
  </div>
  <div class="container">
    {{ $feed := .Site.Params.flickr.feed }}
    {{ if not $feed }}
      {{ with .Site.Params.flickr.username }}
        {{ $feed = printf "https://www.flickr.com/services/feeds/photos_public.gne?format=json&nojsoncallback=1&id=%s" . }}
      {{ end }}
    {{ end }}
    {{ if $feed }}
      {{ $limit := default 6 .Site.Params.flickr.limit }}
      {{ $remote := try (resources.GetRemote $feed) }}
      {{ if $remote.Err }}
        <p class="muted">Photos are unavailable right now.</p>
      {{ else }}
        {{ $data := try ($remote.Value | transform.Unmarshal) }}
        {{ if $data.Err }}
          <p class="muted">Photos are unavailable right now.</p>
        {{ else }}
          {{ $items := $data.Value.items }}
          {{ if $items }}
            <div class="photo-row">
              {{ range first $limit $items }}
                {{ $src := .media.m }}
                {{ if $src }}
                  {{ $thumb := replace $src "_m." "_q." }}
                  <a class="photo-thumb" href="{{ .link }}" target="_blank" rel="noopener" aria-label="{{ .title }}">
                    <img src="{{ $thumb }}" alt="{{ .title }}" loading="lazy">
                  </a>
                {{ end }}
              {{ end }}
            </div>
          {{ else }}
            <p class="muted">No photos yet.</p>
          {{ end }}
        {{ end }}
      {{ end }}
    {{ else }}
      <p class="muted">Add a Flickr public feed to show photos.</p>
    {{ end }}
  </div>
</section>
{{ end }}
